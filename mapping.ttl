@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix dbp: <http://dbpedia.org/resource/> .

@prefix fnml: <http://semweb.mmlab.be/ns/fnml#> .
@prefix fno: <https://w3id.org/function/ontology#> .
@prefix grel: <http://users.ugent.be/~bjdmeest/function/grel.ttl#> .

@prefix cto: <http://data.cyclingtour.fr/data#> .
@prefix cs: <http://data.cyclingtour.fr/schema#> .

@base <http://data.cyclingtour.fr/data#> .

<#MountainMapping> a rr:TriplesMap ;
    rml:logicalSource [
        rml:source "mountains_ready.csv" ;
        rml:referenceFormulation ql:CSV
    ] ;
    
    rr:subjectMap [ rr:template "{URI_Suffix}" ; rr:class cs:Mountain ] ;

    rr:predicateObjectMap [ rr:predicate rdfs:label ; rr:objectMap [ rml:reference "Nom" ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:elevation ; rr:objectMap [ rml:reference "Altitude"; rr:datatype xsd:integer ] ] ;
    rr:predicateObjectMap [ rr:predicate geo:lat ; rr:objectMap [ rml:reference "lat"; rr:datatype xsd:float ] ] ;
    rr:predicateObjectMap [ rr:predicate geo:long ; rr:objectMap [ rml:reference "long"; rr:datatype xsd:float ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:mountainRange ; rr:objectMap [ rr:template "http://dbpedia.org/resource/{Mountain_Range}" ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:specificMountainRange ; rr:objectMap [ rml:reference "Specific_Mountain_Range" ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:country ; rr:objectMap [ rr:template "http://dbpedia.org/resource/{Pays}" ] ] ;
    rr:predicateObjectMap [ rr:predicate owl:sameAs ; rr:objectMap [ rr:template "http://dbpedia.org/resource/{URI_Suffix}" ] ] ;
    
    rr:predicateObjectMap [ 
        rr:predicate cs:isHigherThan ; 
        rr:objectMap [ rr:template "http://dbpedia.org/resource/{Higher_Than}" ] 
    ] .

<#PathMapping> a rr:TriplesMap ;
    rml:logicalSource [
        rml:source "stages_ready.csv" ;
        rml:referenceFormulation ql:CSV
    ] ;

    rr:subjectMap [ rr:template "{Path_ID}" ; rr:class cs:Path ] ;

    rr:predicateObjectMap [
        rr:predicate rdfs:label ; 
        rr:objectMap [ 
            rr:template "{Start_City} - {End_City}" ; 
            rr:termType rr:Literal ; 
            rr:datatype xsd:string 
        ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate cs:hasStart ;
        rr:objectMap [ rr:template "http://dbpedia.org/resource/{Start_City_URI}" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate cs:hasEnd ;
        rr:objectMap [ rr:template "http://dbpedia.org/resource/{End_City_URI}" ]
    ] ;

    rr:predicateObjectMap [ rr:predicate cs:length ; rr:objectMap [ rml:reference "Distance_Value"; rr:datatype xsd:decimal ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:elevationGain ; rr:objectMap [ rml:reference "Elevation_Gain"; rr:datatype xsd:integer ] ] ;

    rr:predicateObjectMap [
        rr:predicate cs:includesMountain ;
        rr:objectMap [
            fnml:functionValue [
                rr:predicateObjectMap [
                    rr:predicate fno:executes ;
                    rr:object grel:string_split ;
                ] ;
                rr:predicateObjectMap [
                    rr:predicate grel:valueParameter ; 
                    rr:objectMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [ rr:predicate fno:executes ; rr:object grel:string_replace ] ;
                            rr:predicateObjectMap [
                                rr:predicate grel:valueParameter ;
                                rr:objectMap [ 
                                    rr:template "http://data.cyclingtour.fr/data#{Mountain_Name}"
                                ]
                            ] ;
                            rr:predicateObjectMap [ rr:predicate grel:p_string_find ; rr:object "%2C" ] ;
                            rr:predicateObjectMap [ 
                                rr:predicate grel:p_string_replace ; 
                                rr:object "%2Chttp://data.cyclingtour.fr/data#"
                            ]
                        ]
                    ]
                ] ;
                rr:predicateObjectMap [ rr:predicate grel:p_string_sep ; rr:object "%2C" ]
            ] ;
            rr:termType rr:IRI ;
        ]
    ] .
