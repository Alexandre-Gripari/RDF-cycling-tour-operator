@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix dbp: <http://dbpedia.org/resource/> .

@prefix cto: <http://data.cyclingtour.fr/data#> .
@prefix cs: <http://data.cyclingtour.fr/schema#> .

@base <http://data.cyclingtour.fr/data#> .

<#MountainMapping> a rr:TriplesMap ;
    rml:logicalSource [
        rml:source "mountains_ready.csv" ;
        rml:referenceFormulation ql:CSV
    ] ;
    
    rr:subjectMap [ rr:template "{URI_Suffix}" ; rr:class cs:Mountain ] ;

    rr:predicateObjectMap [ rr:predicate rdfs:label ; rr:objectMap [ rml:reference "Nom" ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:elevation ; rr:objectMap [ rml:reference "Altitude"; rr:datatype xsd:integer ] ] ;
    rr:predicateObjectMap [ rr:predicate geo:lat ; rr:objectMap [ rml:reference "lat"; rr:datatype xsd:float ] ] ;
    rr:predicateObjectMap [ rr:predicate geo:long ; rr:objectMap [ rml:reference "long"; rr:datatype xsd:float ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:mountainRange ; rr:objectMap [ rr:template "http://dbpedia.org/resource/{Mountain_Range}" ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:specificMountainRange ; rr:objectMap [ rml:reference "Specific_Mountain_Range" ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:country ; rr:objectMap [ rr:template "http://dbpedia.org/resource/{Pays}" ] ] ;
    rr:predicateObjectMap [ rr:predicate owl:sameAs ; rr:objectMap [ rr:template "http://dbpedia.org/resource/{URI_Suffix}" ] ] ;
    
    rr:predicateObjectMap [ 
        rr:predicate cs:isHigherThan ; 
        rr:objectMap [ rr:template "{Higher_Than}" ] 
    ] .

<#PathMapping> a rr:TriplesMap ;
    rr:logicalTable [
        rr:sqlQuery """
            SELECT 
                *,
                CASE 
                    WHEN Elevation_Gain > 3000 THEN 'http://data.cyclingtour.fr/schema#VeryHard'
                    WHEN Elevation_Gain > 2000 THEN 'http://data.cyclingtour.fr/schema#Hard'
                    WHEN Elevation_Gain > 1000 THEN 'http://data.cyclingtour.fr/schema#Moderate'
                    ELSE 'http://data.cyclingtour.fr/schema#Easy'
                END AS difficulty_uri
            FROM stages_ready
        """
    ] ;

    rr:subjectMap [ rr:template "{Path_ID}" ; rr:class cs:Path ] ;

    rr:predicateObjectMap [ rr:predicate rdfs:label ; rr:objectMap [ rr:template "{Start_City_URI} - {End_City_URI}" ] ] ;
    
    rr:predicateObjectMap [
        rr:predicate cs:hasStart ;
        rr:objectMap [ rr:column "Start_City_URI" ; rr:template "http://dbpedia.org/resource/{Start_City_URI}" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate cs:hasEnd ;
        rr:objectMap [ rr:column "End_City_URI" ; rr:template "http://dbpedia.org/resource/{End_City_URI}" ]
    ] ;

    rr:predicateObjectMap [ rr:predicate cs:length ; rr:objectMap [ rr:column "Distance_Value"; rr:datatype xsd:decimal ] ] ;
    rr:predicateObjectMap [ rr:predicate cs:elevationGain ; rr:objectMap [ rr:column "Elevation_Gain"; rr:datatype xsd:integer ] ] ;
    
    rr:predicateObjectMap [ 
        rr:predicate cs:difficulty ; 
        rr:objectMap [ rr:column "difficulty_uri" ; rr:termType rr:IRI ] 
    ] ;

    rr:predicateObjectMap [
        rr:predicate cs:includesMountain ;
        rr:objectMap [
            rr:parentTriplesMap <#MountainMapping> ;
            rr:joinCondition [
                rr:child "Mountain_Name" ;
                rr:parent "Nom" ;          
            ] ;
        ]
    ] .
